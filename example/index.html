<html>
<head>
    <meta charset="utf-8">
    <script src="../src/kkmserver.js"></script>
    <script>

        /**
         * Функция вызываемая после обработки команды - обработка возвращаемых данных
         * @param {{Status,Error,URL,Command,IdCommand,NumDevice}} Rezult - ответ ККM
         */
        function ExecuteSuccess(Rezult) {
            var Responce = "";

            if (Rezult.Status === 0) {
                Responce = Responce + "Статус: " + "Ok" + "\r\n";
            } else if (Rezult.Status === 1) {
                Responce = Responce + "Статус: " + "Выполняется" + "\r\n";
            } else if (Rezult.Status === 2) {
                Responce = Responce + "Статус: " + "Ошибка!" + "\r\n";
            } else if (Rezult.Status === 3) {
                Responce = Responce + "Статус: " + "Данные не найдены!" + "\r\n";
            }


            // Текст ошибки
            if (Rezult.Error !== undefined && Rezult.Error !== "") {
                Responce = Responce + "Ошибка: " + Rezult.Error + "\r\n";
            }

            if (Rezult !== undefined) {
                var JSon = JSON.stringify(Rezult, null, 4);
                Responce = Responce + "JSON ответа: \r\n" + JSon + "\r\n";
            }

            document.getElementById('Responce').textContent = Responce;
        }

        // Инитим
        KkmServer.connect('Admin', '').setHookAjaxSuccess(ExecuteSuccess).setCashierName('Иванова О.П.').setInnKkm('7701237658').setNumDevice(0);

        // свой обработчик ошибок запроса
        function AjaxError(xhr, status) {
            alert("Request failed: " + status);
        }
        KkmServer.setHookAjaxFail(AjaxError);

        // примеры
        function setDevice() {
            KkmServer.setNumDevice(document.getElementById('SetDevice').value);
        }

        function printFiscalOrder(){
            var check = KkmServer.OpenCheck();
            check.addRegisterString('Мыло',1,1,1);
            check.addRegisterString('Шило',1,1,1,18,0,"1234567890123");
            check.addTextString('может очень пригодиться',4);
            check.addBarcodeString('EAN13',"1234567890123");
            check.Data.Cash = 2;
            KkmServer.execute(check.Data);
        }

    </script>
</head>
<body>
<label>Номер устройства:
    <select id="SetDevice" onchange="setDevice()">
        <option value="0">Первое активное: 0</option>
        <option value="1">Устройство №: 1</option>
        <option value="2">Устройство №: 2</option>
        <option value="3">Устройство №: 3</option>
        <option value="4">Устройство №: 4</option>
        <option value="5">Устройство №: 5</option>
        <option value="6">Устройство №: 6</option>
        <option value="7">Устройство №: 7</option>
        <option value="8">Устройство №: 8</option>
    </select></label>
<p>
    <button onclick="printFiscalOrder()" style="width: 300px;">Печать заранее заготовленного чека</button>
</p>

<table>
    <tr>
        <td style="width:50%;vertical-align: top">
            <h2>Команда как аргумент</h2>
            <p>
                <button onclick="KkmServer.execute(KkmServer.CommandOpenShift())" style="width: 300px;">Открытие смены
                </button>
            </p>
            <p>
                <button onclick="KkmServer.execute(KkmServer.CommandXReport())" style="width: 300px;">Печать Х отчета
                </button>
            </p>
            <p>
                <button onclick="KkmServer.execute(KkmServer.CommandZReport())" style="width: 300px;">Печать Z отчета
                </button>
            </p>
            <p>
                <button onclick="KkmServer.execute(KkmServer.CommandOfdReport())" style="width: 300px;">Печать состояния
                    расчетов и связи с
                    ОФД
                </button>
            </p>
            <hr>
            <p>
                <label>Сумма : <input id="Amount" type="text" value="0.01"/></label>
            </p>
            <p>
                <button onclick="KkmServer.execute(KkmServer.CommandPaymentCash(document.getElementById('Amount').value))"
                        style="width: 300px;">Инкассация денег из кассы
                </button>
            </p>
            <p>
                <button onclick="KkmServer.execute(KkmServer.CommandDepositingCash(document.getElementById('Amount').value))"
                        style="width: 300px;">Внесение денег в кассу
                </button>
            </p>
            <p>
                <button onclick="KkmServer.execute(KkmServer.CommandOpenCashDrawer())" style="width: 300px;">Открытие
                    денежного
                    ящика
                </button>
            </p>
            <hr>
            <p>
                <button onclick="KkmServer.execute(KkmServer.CommandGetDataKKT())" style="width: 300px;">Получить
                    текущее
                    состояние ККТ.
                </button>
            </p>
            <hr>
            <p>
                <button onclick="KkmServer.execute(KkmServer.CommandList())" style="width: 300px;">Получение списка ККМ
                </button>
            </p>
        </td>
        <td>
            <h2>Короткий вызов</h2>
            <p>
                <button onclick="KkmServer.openShift()" style="width: 300px;">Открытие смены</button>
            </p>
            <p>
                <button onclick="KkmServer.printXReport()" style="width: 300px;">Печать Х отчета</button>
            </p>
            <p>
                <button onclick="KkmServer.printZReport()" style="width: 300px;">Печать Z отчета</button>
            </p>
            <p>
                <button onclick="KkmServer.printOfdReport()" style="width: 300px;">Печать состояния расчетов и связи с
                    ОФД
                </button>
            </p>
            <hr>
            <p>
                <label>Сумма : <input id="Amount2" type="text" value="10.0"/></label>
            </p>
            <p>
                <button onclick="KkmServer.paymentCash(document.getElementById('Amount2').value)"
                        style="width: 300px;">Инкассация денег из кассы
                </button>
            </p>
            <p>
                <button onclick="KkmServer.depositingCash(document.getElementById('Amount2').value)"
                        style="width: 300px;">Внесение денег в кассу
                </button>
            </p>
            <p>
                <button onclick="KkmServer.openCashDrawer()" style="width: 300px;">Открытие денежного ящика
                </button>
            </p>
            <hr>
            <p>
                <button onclick="KkmServer.getDataKKT()" style="width: 300px;">Получить текущее
                    состояние ККТ.
                </button>
            </p>
            <hr>
            <p>
                <button onclick="KkmServer.getList()" style="width: 300px;">Получение списка ККМ
                </button>
            </p>
            <p>
                <button onclick="KkmServer.getRezult()" style="width: 300px;">Результат последней команды
                </button>
            </p>
        </td>
    </tr>
</table>
<p>Ответ сервера:</p>
<p id="Responce" style="white-space:pre;"></p>


</body>
</html>