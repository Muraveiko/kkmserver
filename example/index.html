<html>
<head>
    <meta charset="utf-8">
    <script src="../src/kkmserver.js"></script>
</head>
<body>
<label>Номер устройства:
    <select id="SetDevice" onchange="setDevice()">
        <option value="0">Первое активное: 0</option>
        <option value="1">Устройство №: 1</option>
        <option value="2">Устройство №: 2</option>
        <option value="3">Устройство №: 3</option>
        <option value="4">Устройство №: 4</option>
        <option value="5">Устройство №: 5</option>
        <option value="6">Устройство №: 6</option>
        <option value="7">Устройство №: 7</option>
        <option value="8">Устройство №: 8</option>
    </select></label>
<p>
    <button onclick="printFiscalOrder()" style="width: 300px;">Печать заранее заготовленного чека</button>
</p>

<table>
    <tr>
        <td style="width:50%;vertical-align: top">
            <h2>Команда как аргумент</h2>
            <p>
                <button onclick="openShiftExtend()" style="width: 300px;">Открытие смены
                </button>
            </p>
            <p>
                <button onclick="Kkm.execute(Kkm.CommandXReport())" style="width: 300px;">Печать Х отчета
                </button>
            </p>
            <p>
                <button onclick="Kkm.execute(Kkm.CommandZReport())" style="width: 300px;">Печать Z отчета
                </button>
            </p>
            <p>
                <button onclick="Kkm.execute(Kkm.CommandOfdReport())" style="width: 300px;">Печать состояния
                    расчетов и связи с
                    ОФД
                </button>
            </p>
            <hr>
            <p>
                <label>Сумма : <input id="Amount" type="text" value="0.01"/></label>
            </p>
            <p>
                <button onclick="Kkm.execute(Kkm.CommandPaymentCash(document.getElementById('Amount').value))"
                        style="width: 300px;">Инкассация денег из кассы
                </button>
            </p>
            <p>
                <button onclick="Kkm.execute(Kkm.CommandDepositingCash(document.getElementById('Amount').value))"
                        style="width: 300px;">Внесение денег в кассу
                </button>
            </p>
            <p>
                <button onclick="Kkm.execute(Kkm.CommandOpenCashDrawer())" style="width: 300px;">Открытие
                    денежного
                    ящика
                </button>
            </p>
            <hr>
            <p>
                <button onclick="Kkm.execute(Kkm.CommandGetDataKKT())" style="width: 300px;">Получить
                    текущее
                    состояние ККТ.
                </button>
            </p>
            <hr>
            <p>
                <button onclick="Kkm.execute(Kkm.CommandList())" style="width: 300px;">Получение списка ККМ
                </button>
            </p>
        </td>
        <td>
            <h2>Короткий вызов</h2>
            <p>
                <button onclick="Kkm.doOpenShift()" style="width: 300px;">Открытие смены</button>
            </p>
            <p>
                <button onclick="Kkm.doXReport()" style="width: 300px;">Печать Х отчета</button>
            </p>
            <p>
                <button onclick="Kkm.doZReport()" style="width: 300px;">Печать Z отчета</button>
            </p>
            <p>
                <button onclick="Kkm.doOfdReport()" style="width: 300px;">Печать состояния расчетов и связи с
                    ОФД
                </button>
            </p>
            <hr>
            <p>
                <label>Сумма : <input id="Amount2" type="text" value="10.0"/></label>
            </p>
            <p>
                <button onclick="Kkm.doPaymentCash(document.getElementById('Amount2').value)"
                        style="width: 300px;">Инкассация денег из кассы
                </button>
            </p>
            <p>
                <button onclick="Kkm.doDepositingCash(document.getElementById('Amount2').value)"
                        style="width: 300px;">Внесение денег в кассу
                </button>
            </p>
            <p>
                <button onclick="Kkm.doOpenCashDrawer()" style="width: 300px;">Открытие денежного ящика
                </button>
            </p>
            <hr>
            <p>
                <button onclick="Kkm.doGetDataKKT()" style="width: 300px;">Получить текущее
                    состояние ККТ.
                </button>
            </p>
            <hr>
            <p>
                <button onclick="Kkm.doGetList()" style="width: 300px;">Получение списка ККМ
                </button>
            </p>
            <p>
                <button onclick="Kkm.doGetRezult()" style="width: 300px;">Результат последней команды
                </button>
            </p>
        </td>
    </tr>
</table>
<p>Ответ сервера:</p>
<p id="Responce" style="white-space:pre;"></p>

<script>
    /**
     * Функция вызываемая после обработки команды - обработка возвращаемых данных
     * @param {KkmResponse} Rezult
     */
    function ExecuteSuccess(Rezult) {
        var Responce = "";
        if (Rezult.Status === 0) {
            Responce = Responce + "Статус: " + "Ok" + "\r\n";
        } else if (Rezult.Status === 1) {
            Responce = Responce + "Статус: " + "Выполняется" + "\r\n";
        } else if (Rezult.Status === 2) {
            Responce = Responce + "Статус: " + "Ошибка!" + "\r\n";
        } else if (Rezult.Status === 3) {
            Responce = Responce + "Статус: " + "Данные не найдены!" + "\r\n";
        }


        // Текст ошибки
        if (Rezult.Error !== undefined && Rezult.Error !== "") {
            Responce = Responce + "Ошибка: " + Rezult.Error + "\r\n";
        }

        if (Rezult !== undefined) {
            var JSon = JSON.stringify(Rezult, null, 4);
            Responce = Responce + "JSON ответа: \r\n" + JSon + "\r\n";
        }

        document.getElementById('Responce').textContent = Responce;
    }

    try {

        // Инитим
        Kkm = new KkmServer('Admin', '').setCashierName('Иванова О.П.').setInnKkm('7701237658').hookAjaxSuccess(ExecuteSuccess).setNumDevice(0);
        // свой обработчик ошибок запроса
        function AjaxError(xhr, status) {
            alert("Request failed: " + status);
        }

        Kkm.hookAjaxFail(AjaxError);

    } catch (err) {
        ExecuteSuccess({Status: 2, Error: err.message});
    }

    // примеры
    function setDevice() {
        Kkm.setNumDevice(document.getElementById('SetDevice').value);
    }

    function printFiscalOrder() {
        try {
            var c = new KkmCheck(Kkm);

            c.r('Мыло', 1, 1, 1).r('Шило', 1, 1, 1, 18, 0, "1234567890123");
            c.addRegisterString('Водка', 1, 100, 100);
            c.t('может очень пригодиться', 4);
            c.b('EAN13', "1234567890123");
            c.setPayments(200);
            c.fiscal();
        } catch (e) {
            ExecuteSuccess({Status: 2, Error: 'JS Ошибка ' + e.name + ":" + e.message + "\n" + e.stack});
        }
    }

    function openShiftExtend(){
        var command = Kkm.CommandOpenShift('Петров');
        command.CashierName = 'Иванов';
        Kkm.execute(command);
    }

    function getListExtend(){
        cList = Kkm.CommandList();
        cList.InnKkm = '1234567890';
        cList.Active = true;
        cList.OnOff = true;
        Kkm.execute(cList);
    }
</script>

</body>
</html>