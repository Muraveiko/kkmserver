<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"classes.list.html":{"id":"classes.list.html","title":"Classes","body":" KkmServer API Classes KkmCommandKkmCommandWithCashierKkmCommandWithAmountKkmCommandListKkmUnitKkmResponseKkmResponseErrorKkmServerKkmCommandCheckKkmCheckPropertyKkmAdditionalCheckPropertyKkmCheckStringKkmCheck Classes Classes KkmCommand KkmCommandWithCashier KkmCommandWithAmount KkmCommandList KkmUnit KkmResponse KkmResponseError KkmServer Класс для взаимодействия с API KkmCommandCheck KkmCheckProperty KkmAdditionalCheckProperty KkmCheckString KkmCheck × Search results Close "},"index.html":{"id":"index.html","title":"Index","body":" KkmServer API Classes KkmCommandKkmCommandWithCashierKkmCommandWithAmountKkmCommandListKkmUnitKkmResponseKkmResponseErrorKkmServerKkmCommandCheckKkmCheckPropertyKkmAdditionalCheckPropertyKkmCheckStringKkmCheck KkmServer.jsJs-библиотека для взаимодействия со специальным сервером(KkmServer), посредствомAjax запросов. Дополнительные библиотеки не требуются. Кратко о KkmServer Программа предназначена для печати и регистрации фискальных/не фискальных чеков на Контрольно-кассовой технике оборудованной фискальным накопителем (далее ККТ). Программа является маленьким HTTP web-сервером и имеет встроенные драйвера ККТ (кроме драйверов Usb-Com). Позволяет печатать/регистрировать чеки с мобильных устройств / планшетов или с настольного ПК из 1с одновременно. Позволяет печатать/регистрировать чеки на KKM подключенных к другим ПК. Есть возможность печати этикеток с штрих-кодами на принтерах этикеток. Так-же возможно использовать ККТ в качестве принтера этикеток. Технология использования - HTTP(Ajax/REST) запрос, данные передаются через JSON; Страница программы Пример использованияСмотрите в ./example/ Благодарность авторуВыразить благодарность и стимулировать дальнейшее развитие библиотеки можно добровольным пожертованиемна яд-кошелек 410013790927405 HistoryАльфа версии 0.2.0 - Извините еще один полный рефакторинг (предыдущий вариант плохо документировался и не получалось сделать автокомплит) 0.1.0 - Переработан полностью набор методов. Добавлена документация. 0.0.2 - Первая публичная версия Index kkmserver.js Js-библиотека для взаимодействия со специальным сервером, посредством Ajax запросов. Дополнительные библиотеки не требуются. Version: 0.2.0 Author: Oleg Muraveyko See: Source code on Github https://github.com/Muraveiko/kkmserver Server API part by Dmitriy Garbuz https://kkmserver.ru/KkmServer × Search results Close "},"KkmCommand.html":{"id":"KkmCommand.html","title":"Class: KkmCommand","body":" KkmServer API Classes KkmCommandKkmCommandWithCashierKkmCommandWithAmountKkmCommandListKkmUnitKkmResponseKkmResponseErrorKkmServerKkmCommandCheckKkmCheckPropertyKkmAdditionalCheckPropertyKkmCheckStringKkmCheck Class: KkmCommand KkmCommand new KkmCommand(command [, numDevice]) Базовая структура запроса к серверу Parameters: Name Type Argument Description command string Имя команды numDevice number &lt;optional&gt; устройство Members Command :string Название команды, одно из зарегистрированных слов api KkmServer.ru. необходимые реализованы как методы CommandXXX KkmServer. Если Вам потребуется не реализованная команда апи LineLength, то ее можно объявить явно. Type: string Example kkm.execute(new KkmCommand('LineLength')); NumDevice :number|null Номер устройства 0-9 по умолчанию 0 - первое свободное Type: number | null See: KkmServer#setNumDevice IdCommand :string Уникальный идентификатор команды Любая строока из 40 символов По этому идентификатору можно запросить результат выполнения команды. Поле не обязательно Type: string See: KkmServer#setIdCommand KeySubLicensing :string Kлюч суб-лицензии Type: string See: KkmServer#setKeySubLicensing InnKkm :string ИНН ККМ. Если &quot;&quot; то ККМ ищется только по NumDevice, Если NumDevice = 0 а InnKkm заполнено то ККМ ищется только по InnKkm Type: string See: KkmServer#setInnKkm KkmCheck#setInnKkm KktNumber :string Заводской номер ККМ для поиска. Если &quot;&quot; то ККМ ищется только по NumDevice Type: string See: KkmServer.setKktNumber Timeout :number Время (сек) ожидания выполнения команды. Если За это время команда не выполнилась в статусе вернется результат &quot;NotRun&quot; или &quot;Run&quot; Проверить результат еще не выполненной команды можно командой &quot;GetRezult&quot; Если не указано или 0 - то значение по умолчанию 60 сек. Это поле можно указвать во всех командах Type: number × Search results Close "},"KkmCommandWithCashier.html":{"id":"KkmCommandWithCashier.html","title":"Class: KkmCommandWithCashier","body":" KkmServer API Classes KkmCommandKkmCommandWithCashierKkmCommandWithAmountKkmCommandListKkmUnitKkmResponseKkmResponseErrorKkmServerKkmCommandCheckKkmCheckPropertyKkmAdditionalCheckPropertyKkmCheckStringKkmCheck Class: KkmCommandWithCashier KkmCommandWithCashier new KkmCommandWithCashier(command [, cashierName] [, numDevice]) Структура запроса к серверу c ФИО кассира Parameters: Name Type Argument Description command string Имя команды cashierName string &lt;optional&gt; ФИО Кассира numDevice number &lt;optional&gt; устройство Extends KkmCommand Members CashierName :string|null ФИО Кассира Type: string | null Command :string Название команды, одно из зарегистрированных слов api KkmServer.ru. необходимые реализованы как методы CommandXXX KkmServer. Если Вам потребуется не реализованная команда апи LineLength, то ее можно объявить явно. Type: string Inherited From: KkmCommand#Command Example kkm.execute(new KkmCommand('LineLength')); NumDevice :number|null Номер устройства 0-9 по умолчанию 0 - первое свободное Type: number | null Inherited From: KkmCommand#NumDevice See: KkmServer#setNumDevice IdCommand :string Уникальный идентификатор команды Любая строока из 40 символов По этому идентификатору можно запросить результат выполнения команды. Поле не обязательно Type: string Inherited From: KkmCommand#IdCommand See: KkmServer#setIdCommand KeySubLicensing :string Kлюч суб-лицензии Type: string Inherited From: KkmCommand#KeySubLicensing See: KkmServer#setKeySubLicensing InnKkm :string ИНН ККМ. Если &quot;&quot; то ККМ ищется только по NumDevice, Если NumDevice = 0 а InnKkm заполнено то ККМ ищется только по InnKkm Type: string Inherited From: KkmCommand#InnKkm See: KkmServer#setInnKkm KkmCheck#setInnKkm KktNumber :string Заводской номер ККМ для поиска. Если &quot;&quot; то ККМ ищется только по NumDevice Type: string Inherited From: KkmCommand#KktNumber See: KkmServer.setKktNumber Timeout :number Время (сек) ожидания выполнения команды. Если За это время команда не выполнилась в статусе вернется результат &quot;NotRun&quot; или &quot;Run&quot; Проверить результат еще не выполненной команды можно командой &quot;GetRezult&quot; Если не указано или 0 - то значение по умолчанию 60 сек. Это поле можно указвать во всех командах Type: number Inherited From: KkmCommand#Timeout × Search results Close "},"KkmCommandWithAmount.html":{"id":"KkmCommandWithAmount.html","title":"Class: KkmCommandWithAmount","body":" KkmServer API Classes KkmCommandKkmCommandWithCashierKkmCommandWithAmountKkmCommandListKkmUnitKkmResponseKkmResponseErrorKkmServerKkmCommandCheckKkmCheckPropertyKkmAdditionalCheckPropertyKkmCheckStringKkmCheck Class: KkmCommandWithAmount KkmCommandWithAmount new KkmCommandWithAmount(command, amount, cashierName, numDevice) Структура запроса к серверу c суммой операции Parameters: Name Type Description command string Имя команды amount number Сумма cashierName string ФИО Кассира numDevice number устройство Extends KkmCommandWithCashier Members Amount :number Сумма операции Type: number CashierName :string|null ФИО Кассира Type: string | null Inherited From: KkmCommandWithCashier#CashierName Command :string Название команды, одно из зарегистрированных слов api KkmServer.ru. необходимые реализованы как методы CommandXXX KkmServer. Если Вам потребуется не реализованная команда апи LineLength, то ее можно объявить явно. Type: string Inherited From: KkmCommand#Command Example kkm.execute(new KkmCommand('LineLength')); NumDevice :number|null Номер устройства 0-9 по умолчанию 0 - первое свободное Type: number | null Inherited From: KkmCommand#NumDevice See: KkmServer#setNumDevice IdCommand :string Уникальный идентификатор команды Любая строока из 40 символов По этому идентификатору можно запросить результат выполнения команды. Поле не обязательно Type: string Inherited From: KkmCommand#IdCommand See: KkmServer#setIdCommand KeySubLicensing :string Kлюч суб-лицензии Type: string Inherited From: KkmCommand#KeySubLicensing See: KkmServer#setKeySubLicensing InnKkm :string ИНН ККМ. Если &quot;&quot; то ККМ ищется только по NumDevice, Если NumDevice = 0 а InnKkm заполнено то ККМ ищется только по InnKkm Type: string Inherited From: KkmCommand#InnKkm See: KkmServer#setInnKkm KkmCheck#setInnKkm KktNumber :string Заводской номер ККМ для поиска. Если &quot;&quot; то ККМ ищется только по NumDevice Type: string Inherited From: KkmCommand#KktNumber See: KkmServer.setKktNumber Timeout :number Время (сек) ожидания выполнения команды. Если За это время команда не выполнилась в статусе вернется результат &quot;NotRun&quot; или &quot;Run&quot; Проверить результат еще не выполненной команды можно командой &quot;GetRezult&quot; Если не указано или 0 - то значение по умолчанию 60 сек. Это поле можно указвать во всех командах Type: number Inherited From: KkmCommand#Timeout × Search results Close "},"KkmCommandList.html":{"id":"KkmCommandList.html","title":"Class: KkmCommandList","body":" KkmServer API Classes KkmCommandKkmCommandWithCashierKkmCommandWithAmountKkmCommandListKkmUnitKkmResponseKkmResponseErrorKkmServerKkmCommandCheckKkmCheckPropertyKkmAdditionalCheckPropertyKkmCheckStringKkmCheck Class: KkmCommandList KkmCommandList new KkmCommandList() Команда Список ККТ подключенных к серверу Extends KkmCommand Members InnKkm :string Отбор по ИНН. Строка. Если &quot;&quot; или не указано то первое не блокированное на сервере Type: string Overrides: KkmCommand#InnKkm Active :boolean|null Отбор активных. Булево. Если null или не указано то активные и не активные Type: boolean | null Example command = new KkmCommandList(); command.InnKkm = '1234567890'; OnOff :boolean|null Отбор выключенны-включенных Type: boolean | null Example command = new KkmCommandList(); command.Active = true; OFD_Error :boolean|null Отбор наличию ошибок ОФВ. Булево. Если null или не указано то с ошибками и без Type: boolean | null OFD_DateErrorDoc :string Все у которых дата не переданного док. в ОФД меньше указанной. Дата-время. Type: string Example command = new KkmCommandList(); command.OFD_DateErrorDoc = '2100-01-01T00:00:00'; FN_DateEnd :string Все у которых дата окончания работы ФН меньше указанной. Дата-время. Type: string FN_MemOverflowl :boolean|null Все у которых заканчивается память ФН; Булево. Если null или не указано то все Type: boolean | null FN_IsFiscal :boolean|null Фискализированные или нет ФН; Булево. Если null или не указано то все Type: boolean | null Command :string Название команды, одно из зарегистрированных слов api KkmServer.ru. необходимые реализованы как методы CommandXXX KkmServer. Если Вам потребуется не реализованная команда апи LineLength, то ее можно объявить явно. Type: string Inherited From: KkmCommand#Command Example kkm.execute(new KkmCommand('LineLength')); NumDevice :number|null Номер устройства 0-9 по умолчанию 0 - первое свободное Type: number | null Inherited From: KkmCommand#NumDevice See: KkmServer#setNumDevice IdCommand :string Уникальный идентификатор команды Любая строока из 40 символов По этому идентификатору можно запросить результат выполнения команды. Поле не обязательно Type: string Inherited From: KkmCommand#IdCommand See: KkmServer#setIdCommand KeySubLicensing :string Kлюч суб-лицензии Type: string Inherited From: KkmCommand#KeySubLicensing See: KkmServer#setKeySubLicensing KktNumber :string Заводской номер ККМ для поиска. Если &quot;&quot; то ККМ ищется только по NumDevice Type: string Inherited From: KkmCommand#KktNumber See: KkmServer.setKktNumber Timeout :number Время (сек) ожидания выполнения команды. Если За это время команда не выполнилась в статусе вернется результат &quot;NotRun&quot; или &quot;Run&quot; Проверить результат еще не выполненной команды можно командой &quot;GetRezult&quot; Если не указано или 0 - то значение по умолчанию 60 сек. Это поле можно указвать во всех командах Type: number Inherited From: KkmCommand#Timeout × Search results Close "},"KkmUnit.html":{"id":"KkmUnit.html","title":"Class: KkmUnit","body":" KkmServer API Classes KkmCommandKkmCommandWithCashierKkmCommandWithAmountKkmCommandListKkmUnitKkmResponseKkmResponseErrorKkmServerKkmCommandCheckKkmCheckPropertyKkmAdditionalCheckPropertyKkmCheckStringKkmCheck Class: KkmUnit KkmUnit new KkmUnit() Информация об одном устройстве в списке подключенных Properties: Name Type Description NumDevice number Номер [1-9] устройства на сервере IdDevice string Уникальный ид, присвоенный сервером OnOff boolean Включено Active boolean Активно TypeDevice string IdTypeDevice string IP string Если подключено по сети NameDevice string UnitName string KktNumber string Заводской номер кассового аппарата INN string ИНН организации NameOrganization string Наименование организации TaxVariant number При нескольких СНО через запятую, например: &quot;0,3,5&quot; AddDate string Когда добавлено на сервере OFD_Error string Если не пусто, то сообщение об ошибке обмена с ОФД OFD_NumErrorDoc number Количество не переданных документов в ОФД OFD_DateErrorDoc string Дата первого не переданного документа в ОФД FN_DateEnd string Когда нужно менять фискальный накопитель FN_MemOverflowl boolean Приближается переполнение фискального накопителя FN_IsFiscal boolean Кассовый принтер или фискальный аппарат PaperOver boolean Закончилась бумага See: KkmServer#CommandList KkmServer#doGetList × Search results Close "},"KkmResponse.html":{"id":"KkmResponse.html","title":"Class: KkmResponse","body":" KkmServer API Classes KkmCommandKkmCommandWithCashierKkmCommandWithAmountKkmCommandListKkmUnitKkmResponseKkmResponseErrorKkmServerKkmCommandCheckKkmCheckPropertyKkmAdditionalCheckPropertyKkmCheckStringKkmCheck Class: KkmResponse KkmResponse new KkmResponse() Ответ API Здесь перечислены все возможные свойства, которые могут присутствувать в ответе. Командно-зависимые описаны как property Properties: Name Type Argument Description URL string &lt;optional&gt; URL проверки чека t=20170115T154700&amp;s=0.01&amp;fn=99078900002287&amp;i=118&amp;fp=549164494&amp;n=1 где: t-дата-время, s-сумма документа, fn-номер ФН, i-номер документа, fp-фискальная подпись, n-тип документа CheckNumber number &lt;optional&gt; Номер документа SessionNumber number &lt;optional&gt; Номер смены Info object &lt;optional&gt; состояние Ккт Properties Name Type Description UrlServerOfd string URL или IP сервера ОФД PortServerOfd number IP-порт сервера ОФД NameOFD string Наименование ОФД UrlOfd string префикс URL ОФД для поиска чека InnOfd string ИНН ОФД EncryptionMode boolean Шифрование OfflineMode boolean Автономный режим AutomaticMode boolean Автоматический режим InternetMode boolean Расчеты в Интернете BSOMode boolean Бланки строгой отчетности ServiceMode boolean Применение в сфере услуг InnOrganization string ИНН организации NameOrganization string Наименование организации AddressSettle string Адрес установки ККМ TaxVariant string | number При нескольких СНО через запятую, например: &quot;0,3,5&quot; KktNumber string Заводской номер кассового аппарата FnNumber string Заводской номер фискального регистратора RegNumber string Регистрационный номер ККТ (из налоговой) OnOff boolean выключена-включенна Active boolean автивна/неактивна (на связи) Command string ???? FN_IsFiscal boolean Кассовый принтер или фискальный аппарат FN_MemOverflowl boolean Приближается переполнение фискального накопителя FN_DateEnd string Когда нужно менять фискальный накопитель OFD_Error string Если не пусто, то сообщение об ошибке обмена с ОФД OFD_NumErrorDoc number Количество не переданных документов в ОФД OFD_DateErrorDoc string Дата первого не переданного документа в ОФД SessionState number Статус сессии 1-Закрыта, 2-Открыта, 3-Открыта, но закончилась (3 статус на старых ККМ может быть не опознан) FFDVersion string FFDVersionFN string FFDVersionKKT string PaperOver boolean Закончилась бумага BalanceCash number Остаток наличных LessType1 string Название 1 типа безналичных расчетов LessType2 string Название 2 типа безналичных расчетов LessType3 string Название 3 типа безналичных расчетов LicenseExpirationDate string Rezult KkmResponse &lt;optional&gt; ответ на запрос о выполнении команды ListUnit Array.&lt;KkmUnit&gt; &lt;optional&gt; Список подключенных устройств Members Status :number Status Статус исполнения Ok = 0,Run(Запущено на выполнение) = 1,Error = 2, NotFound(устройство не найдено) = 3,NotRun = 4 Type: number Error :string Пустая строка или текст ошибки Type: string Command :string Команда апи KkmCommand#Command Type: string IdCommand :string Уникальный идентификатор комманды, назначенный вами или присвоенный сервером. Type: string NumDevice :number Номер устройства выполневшего команду Type: number UnitName :string Название устройства Type: string × Search results Close "},"KkmResponseError.html":{"id":"KkmResponseError.html","title":"Class: KkmResponseError","body":" KkmServer API Classes KkmCommandKkmCommandWithCashierKkmCommandWithAmountKkmCommandListKkmUnitKkmResponseKkmResponseErrorKkmServerKkmCommandCheckKkmCheckPropertyKkmAdditionalCheckPropertyKkmCheckStringKkmCheck Class: KkmResponseError KkmResponseError new KkmResponseError(errMessage) Эмуляция сообщение об ошибке от API используется во встроенном обработчике ошибки ajax запроса Parameters: Name Type Description errMessage See: KkmServer#hookAjaxFail Extends KkmResponse Members Status :number Status Статус исполнения Ok = 0,Run(Запущено на выполнение) = 1,Error = 2, NotFound(устройство не найдено) = 3,NotRun = 4 Type: number Inherited From: KkmResponse#Status Error :string Пустая строка или текст ошибки Type: string Inherited From: KkmResponse#Error Command :string Команда апи KkmCommand#Command Type: string Inherited From: KkmResponse#Command IdCommand :string Уникальный идентификатор комманды, назначенный вами или присвоенный сервером. Type: string Inherited From: KkmResponse#IdCommand NumDevice :number Номер устройства выполневшего команду Type: number Inherited From: KkmResponse#NumDevice UnitName :string Название устройства Type: string Inherited From: KkmResponse#UnitName × Search results Close "},"KkmServer.html":{"id":"KkmServer.html","title":"Class: KkmServer","body":" KkmServer API Classes KkmCommandKkmCommandWithCashierKkmCommandWithAmountKkmCommandListKkmUnitKkmResponseKkmResponseErrorKkmServerKkmCommandCheckKkmCheckPropertyKkmAdditionalCheckPropertyKkmCheckStringKkmCheck Class: KkmServer KkmServer new KkmServer(user, password [, urlServer]) Класс для взаимодействия с API Методы класса можно разделить на группы Внутренние: funXxx - встроенные обработчики AJAX Публичные: CommandXxx - возвращают структуру данных для передачи серверу, которую можно модифицировать doXxx - выполняют сразу нужную операцию hookXxx - установить свои обработчики для AJAX setXxx - устанавливают параметры по умолчанию для команд execute - посылает ajax запрос серверу с тонкой настройкой Через посредника: чеки - отдельный класс KkmCheck Конструктор принимает параметры подключения к серверу : Parameters: Name Type Argument Description user string Имя пользователя password string Пароль urlServer string &lt;optional&gt; Адрес сервера Example var kkm = new KkmServer('Admin', '','http://localhost:5893/').hookAjaxSuccess(ExecuteSuccess); kkm.doOpenShift(); Members lastCommand :* Последняя посланная серверу команда. Только для отладки. Type: * Methods execute(command [, successHook] [, errorHook]) Передача команды серверу . Parameters: Name Type Argument Description command KkmCommand | KkmCommandWithCashier | KkmCommandWithAmount | KkmCommandList | KkmCommandCheck Структура для передачи серверу successHook &lt;optional&gt; по умолчанию обработчик объявленый через hookAjaxSuccess errorHook &lt;optional&gt; по умолчанию обработчик объявленый через hookAjaxFail Returns: Type KkmCommand | KkmCommandWithCashier | KkmCommandWithAmount | KkmCommandList | KkmCommandCheck &lt;inner&gt; funSuccess(result) Встроенный обработчик успешного запроса к серверу Parameters: Name Type Description result KkmResponse | object See: назначить свой hookAjaxSuccess &lt;inner&gt; funError(xhr, status) Встроенный обработчик ошибки сети при запросе к серверу Parameters: Name Type Description xhr status See: назначить свой hookAjaxFail hookAjaxSuccess(successHook) Назначить обработчик успешного запроса к серверу по умолчанию Parameters: Name Type Description successHook KkmServer~KkmApiСallback функция обработчик See: исходный код funSuccess Returns: Type KkmServer hookAjaxFail(errorHook) Назначить обработчик ошибки запроса Parameters: Name Type Description errorHook funError callback See: исходный код funError Returns: Type KkmServer setKeySubLicensing(key) СубЛицензия Parameters: Name Type Description key string Returns: Type KkmServer setNumDevice(numDevice) Номер Устройства по умолчанию Parameters: Name Type Description numDevice number целое 0-9 Returns: Type KkmServer setCashierName(cashierName) Кассир по умолчанию Parameters: Name Type Description cashierName string ФИО Returns: Type KkmServer setInnKkm(innKkm) Инн кассы по умолчанию (для исполнения команды ищется ккт, зарегистрированная на этот инн) Parameters: Name Type Description innKkm string Returns: Type KkmServer setKktNumber(kktNumber) Для исполнения команды будет использована ккт с этим заводским номером Parameters: Name Type Description kktNumber string Returns: Type KkmServer CommandDepositingCash(amount [, cashierName] [, numDevice]) Команда Внесение денег в кассу Parameters: Name Type Argument Description amount number Сумма cashierName string &lt;optional&gt; имя кассира numDevice number &lt;optional&gt; устройство See: CommandPaymentCash Returns: Type KkmCommandWithAmount CommandGetDataKKT( [numDevice]) Команда Получение данных KKT Parameters: Name Type Argument Description numDevice number &lt;optional&gt; устройство Returns: Type KkmCommand CommandGetRezult( [idCommand] [, numDevice]) Команда Запрос результата выполнения команды Parameters: Name Type Argument Description idCommand string &lt;optional&gt; numDevice number &lt;optional&gt; устройство Returns: Type KkmCommand CommandList() Команда Список подключенных устройств See: элемент массива ListUnit в ответе сервера Returns: Type KkmCommandList CommandPaymentCash(Amount [, CashierName] [, numDevice]) Команда Выемка наличных Parameters: Name Type Argument Description Amount number Сумма CashierName string &lt;optional&gt; имя кассира numDevice number &lt;optional&gt; устройство Returns: Type KkmCommandWithAmount CommandOfdReport( [numDevice]) Команда Печать состояния обмена с ОФД Parameters: Name Type Argument Description numDevice number &lt;optional&gt; устройство Returns: Type KkmCommand CommandOpenCashDrawer( [numDevice]) Команда Открыть денежный ящик Parameters: Name Type Argument Description numDevice number &lt;optional&gt; устройство Returns: Type KkmCommand CommandOpenShift( [CashierName] [, numDevice]) Команда Окрыть смену Parameters: Name Type Argument Description CashierName string &lt;optional&gt; имя кассира numDevice number &lt;optional&gt; устройство Returns: Type KkmCommandWithCashier CommandXReport( [CashierName] [, numDevice]) Команда Печать Х-отчета Parameters: Name Type Argument Description CashierName string &lt;optional&gt; имя кассира numDevice number &lt;optional&gt; устройство Returns: Type KkmCommandWithCashier CommandZReport( [CashierName] [, numDevice]) Команда Закрытие смены Parameters: Name Type Argument Description CashierName string &lt;optional&gt; имя кассира numDevice number &lt;optional&gt; устройство Returns: Type KkmCommandWithCashier doDepositingCash(Amount [, CashierName] [, numDevice]) Внесение денег в кассу Parameters: Name Type Argument Description Amount number Сумма CashierName string &lt;optional&gt; имя кассира numDevice number &lt;optional&gt; устройство Returns: Type KkmCommandWithAmount doGetDataKKT( [numDevice]) Получение данных KKT Parameters: Name Type Argument Description numDevice number &lt;optional&gt; устройство Returns: Type KkmCommand doGetList() Список ККТ подключенных к серверу Returns: Type KkmCommand doGetRezult( [idCommand] [, numDevice]) Запрос результата выполнения команды Parameters: Name Type Argument Description idCommand string &lt;optional&gt; numDevice number &lt;optional&gt; устройство Returns: Type KkmCommand doPaymentCash(Amount [, CashierName] [, numDevice]) Выемка наличных Parameters: Name Type Argument Description Amount number Сумма CashierName string &lt;optional&gt; имя кассира numDevice number &lt;optional&gt; устройство Returns: Type KkmCommandWithAmount doOfdReport( [numDevice]) Печать состояния обмена с ОФД Parameters: Name Type Argument Description numDevice number &lt;optional&gt; устройство Returns: Type KkmCommand doXReport( [CashierName] [, numDevice]) Печать Х-отчета Parameters: Name Type Argument Description CashierName string &lt;optional&gt; имя кассира numDevice number &lt;optional&gt; устройство Returns: Type KkmCommand doZReport( [CashierName] [, numDevice]) Закрытие смены Parameters: Name Type Argument Description CashierName string &lt;optional&gt; имя кассира numDevice number &lt;optional&gt; устройство Returns: Type KkmCommand doOpenCashDrawer( [numDevice]) Открыть денежный ящик Parameters: Name Type Argument Description numDevice number &lt;optional&gt; устройство Returns: Type KkmCommand doOpenShift( [cashierName] [, numDevice]) Окрыть смену Parameters: Name Type Argument Description cashierName string &lt;optional&gt; имя кассира numDevice number &lt;optional&gt; устройство Returns: Type KkmCommandWithCashier Type Definitions KkmApiСallback(ответ) Описание интерфейса для функции обратного вызова Parameters: Name Type Description ответ KkmResponse от АПИ See: установка хука × Search results Close "},"KkmCommandCheck.html":{"id":"KkmCommandCheck.html","title":"Class: KkmCommandCheck","body":" KkmServer API Classes KkmCommandKkmCommandWithCashierKkmCommandWithAmountKkmCommandListKkmUnitKkmResponseKkmResponseErrorKkmServerKkmCommandCheckKkmCheckPropertyKkmAdditionalCheckPropertyKkmCheckStringKkmCheck Class: KkmCommandCheck KkmCommandCheck new KkmCommandCheck( [typeCheck]) Структура запроса к апи для работы с чеком советую использовать обертку над командой Parameters: Name Type Argument Default Description typeCheck number &lt;optional&gt; 0 Тип чека See: KkmCheck Extends KkmCommand Members IsFiscalCheck :boolean Это фискальный или не фискальный чек При работе через KkmCheck устанавливается автоматически при вызове методов fiscalXxx(), print() в нужное значение Type: boolean TypeCheck :number Тип чека; Тип чека : 0 – продажа; 10 – покупка; 1 – возврат продажи; 11 - возврат покупки; Для новых ККМ: 2 – корректировка продажи; 12 - корректировка покупки 3 – корректировка возврата продажи; 13 - корректировка возврата покупки Значение передается в конструктор класса KkmCheck Type: number Default Value: 0 CancelOpenedCheck :boolean Аннулировать открытый чек если ранее чек небыл завершен до конца (устарело) Type: boolean Deprecated: Yes NotPrint :boolean Не печатать чек на бумагу Type: boolean See: KkmCheck#fiscalOnly KkmCheck#setNotPrint NumberCopies :number Количество копий документа Type: number See: KkmCheck#setNumberCopies CashierName :string Продавец, тег ОФД 1021 Type: string See: KkmCheck#setCashierName KkmServer#setCashierName ClientAddress :string Телефон или е-Майл покупателя, тег ОФД 1008 Если чек не печатается (NotPrint = true) то указывать обязательно Type: string See: KkmCheck#setEmail KkmCheck#setPhone TaxVariant :number Система налогообложения (СНО) применяемая для чека. Если не указанно - система СНО настроенная в ККМ по умолчанию 0: Общая СНО - ОСН 1: Упрощенная СНО (Доход) 2: Упрощенная СНО(Доход минус Расход) 3: Единый налог на вмененный доход 4: Единый сельскохозяйственный налог 5: Патентная система налогообложения Комбинация разных СНО не возможна Надо указываеть если ККМ настроена на несколько систем СНО Type: number See: KkmCheck#setSno KkmCheck#setTaxVariant CheckProps :Array.&lt;KkmCheckProperty&gt; Дополниельные реквизиты чека (не обязательно) Type: Array.&lt;KkmCheckProperty&gt; See: KkmCheck#addCheckProps AdditionalProps :Array.&lt;KkmAdditionalCheckProperty&gt; Дополнительные произвольные реквизиты (не обязательно) пока только 1 строка Type: Array.&lt;KkmAdditionalCheckProperty&gt; See: KkmCheck#addAdditionalProps ClientId :string Это только для тестов Type: string KPP :string КПП организации, нужно только для ЕГАИС Type: string See: KkmCheck#setKpp CheckStrings :Array.&lt;KkmCheckString&gt; Строки чека Type: Array.&lt;KkmCheckString&gt; See: KkmCheck#addRegisterString KkmCheck#addTextString KkmCheck#addBarcodeString KkmCheck#addImageString Cash :number Наличная оплата Type: number See: KkmCheck#setTotal KkmCheck#setPayments CashLessType1 :number Безналичная оплата типа 1 (по умолчанию - Оплата картой) Type: number See: KkmCheck#setTotal KkmCheck#setPayments CashLessType2 :number Безналичная оплата типа 2 (по умолчанию - Оплата кредитом) Type: number See: KkmCheck#setPayments CashLessType3 :number Безналичная оплата типа 3 (по умолчанию - Оплата сертификатом) Type: number See: KkmCheck#setPayments Command :string Название команды, одно из зарегистрированных слов api KkmServer.ru. необходимые реализованы как методы CommandXXX KkmServer. Если Вам потребуется не реализованная команда апи LineLength, то ее можно объявить явно. Type: string Inherited From: KkmCommand#Command Example kkm.execute(new KkmCommand('LineLength')); NumDevice :number|null Номер устройства 0-9 по умолчанию 0 - первое свободное Type: number | null Inherited From: KkmCommand#NumDevice See: KkmServer#setNumDevice IdCommand :string Уникальный идентификатор команды Любая строока из 40 символов По этому идентификатору можно запросить результат выполнения команды. Поле не обязательно Type: string Inherited From: KkmCommand#IdCommand See: KkmServer#setIdCommand KeySubLicensing :string Kлюч суб-лицензии Type: string Inherited From: KkmCommand#KeySubLicensing See: KkmServer#setKeySubLicensing InnKkm :string ИНН ККМ. Если &quot;&quot; то ККМ ищется только по NumDevice, Если NumDevice = 0 а InnKkm заполнено то ККМ ищется только по InnKkm Type: string Inherited From: KkmCommand#InnKkm See: KkmServer#setInnKkm KkmCheck#setInnKkm KktNumber :string Заводской номер ККМ для поиска. Если &quot;&quot; то ККМ ищется только по NumDevice Type: string Inherited From: KkmCommand#KktNumber See: KkmServer.setKktNumber Timeout :number Время (сек) ожидания выполнения команды. Если За это время команда не выполнилась в статусе вернется результат &quot;NotRun&quot; или &quot;Run&quot; Проверить результат еще не выполненной команды можно командой &quot;GetRezult&quot; Если не указано или 0 - то значение по умолчанию 60 сек. Это поле можно указвать во всех командах Type: number Inherited From: KkmCommand#Timeout × Search results Close "},"KkmCheckProperty.html":{"id":"KkmCheckProperty.html","title":"Class: KkmCheckProperty","body":" KkmServer API Classes KkmCommandKkmCommandWithCashierKkmCommandWithAmountKkmCommandListKkmUnitKkmResponseKkmResponseErrorKkmServerKkmCommandCheckKkmCheckPropertyKkmAdditionalCheckPropertyKkmCheckStringKkmCheck Class: KkmCheckProperty KkmCheckProperty new KkmCheckProperty(print, printInHeader, teg, value) Свойство чека Parameters: Name Type Description print boolean печатать printInHeader boolean печатать в шапке teg number номер тега value string значение тега See: KkmCheck#addCheckProps Members Print :boolean печатать Type: boolean PrintInHeader :boolean печатать в шапке Type: boolean Teg :number Номер тега 1005 Адрес оператора по переводу денежных средств (Строка 100) 1016 ИНН оператора по переводу денежных средств (Строка 12) 1026 Наименование оператора по переводу денежных средств (Строка 64) 1044 Операция банковского агента (Строка 24) 1045 Операция банковского субагента (Строка 24) 1073 Телефон банковского агента (Строка 19) 1074 Телефон платежного агента (Строка 19) 1075 Телефона оператора по переводу денежных средств (Строка 19) 1082 Телефон банковского субагента (Строка 19) 1083 Телефон платежного субагента (Строка 19) 1119 Телефон оператора по приему платежей (Строка 19) 1117 адрес электронной почты отправителя чека Type: number Prop :string Значение тега Type: string × Search results Close "},"KkmAdditionalCheckProperty.html":{"id":"KkmAdditionalCheckProperty.html","title":"Class: KkmAdditionalCheckProperty","body":" KkmServer API Classes KkmCommandKkmCommandWithCashierKkmCommandWithAmountKkmCommandListKkmUnitKkmResponseKkmResponseErrorKkmServerKkmCommandCheckKkmCheckPropertyKkmAdditionalCheckPropertyKkmCheckStringKkmCheck Class: KkmAdditionalCheckProperty KkmAdditionalCheckProperty new KkmAdditionalCheckProperty(print, printInHeader, name, value) Дополнительное свойство чека Parameters: Name Type Description print boolean печатать printInHeader boolean печатать в шапке name string название value string значение тега See: KkmCheck#addAdditionalProps Members Print :boolean печатать Type: boolean PrintInHeader :boolean печатать в шапке Type: boolean NameProp :string Название Type: string Prop :string Значение тега Type: string × Search results Close "},"KkmCheckString.html":{"id":"KkmCheckString.html","title":"Class: KkmCheckString","body":" KkmServer API Classes KkmCommandKkmCommandWithCashierKkmCommandWithAmountKkmCommandListKkmUnitKkmResponseKkmResponseErrorKkmServerKkmCommandCheckKkmCheckPropertyKkmAdditionalCheckPropertyKkmCheckStringKkmCheck Class: KkmCheckString KkmCheckString new KkmCheckString() Общая структура для описания строк чека Members PrintText :null|Object текстовая строка Type: null | Object Properties: Name Type Description Text string Font number Intensity number See: KkmCheck#addTextString Register :null|Object регистрация продажи Type: null | Object Properties: Name Type Description Name string Quantity number Price number Amount number Department number Tax number EAN13 string EGAIS object See: KkmCheck#addRegisterString BarCode :null|Object штрихкод Type: null | Object Properties: Name Type Description BarcodeType string Barcode string See: KkmCheck#addBarcodeString PrintImage :null|Object Картинка Type: null | Object Properties: Name Type Description Image string See: KkmCheck#addImageString × Search results Close "},"KkmCheck.html":{"id":"KkmCheck.html","title":"Class: KkmCheck","body":" KkmServer API Classes KkmCommandKkmCommandWithCashierKkmCommandWithAmountKkmCommandListKkmUnitKkmResponseKkmResponseErrorKkmServerKkmCommandCheckKkmCheckPropertyKkmAdditionalCheckPropertyKkmCheckStringKkmCheck Class: KkmCheck KkmCheck new KkmCheck(kkm [, typeCheck]) Конструктор Класса Чек (для работы с фискальным документом или слип-чеком) Parameters: Name Type Argument Default Description kkm KkmServer куда посылать typeCheck number &lt;optional&gt; 0 Тип чека 0 – продажа; 10 – покупка; 1 – возврат продажи; 11 - возврат покупки; 8 - продажа только по ЕГАИС (обычный чек ККМ не печатается) 9 - возврат продажи только по ЕГАИС (обычный чек ККМ не печатается) Example // ранее у Вас должен быть определен // var kkm = new KkmServer(...); var check = new KkmCheck(kkm,0); // 0 - здесь явно указал тип продажа // дальше формируем его check.r(...).t(...).b(...).i(...) // рекомендую использовать шорткаты // или полные варианты addXxxString(), если нужно модифицировать сформированную строку var goodsWithEgais = check.addRegisterString(...); goodsWithEgais.EGAIS = { Barcode: &quot;22N0000154NUCPRZ3R8381461004001003499NKAQ0ZBUVDNV62JQAR69PEV878RO93V&quot;, Ean: &quot;3423290167937&quot;, Volume: 0.7500, }; // и в конце вызываем check.fiscal(); // или .print() Members kkm :KkmServer ккм - сервер Type: KkmServer &lt;inner&gt; data :KkmCommandCheck Данные для передачи апи Type: KkmCommandCheck Methods setInnKkm(innKkm) Используется для предотвращения ошибочных регистраций чеков на ККТ зарегистрированных с другим ИНН (сравнивается со значением в ФН). Допустимое количество символов 10 или 12. Parameters: Name Type Description innKkm string ИНН организации Returns: Type KkmCheck setPaymentAddress(paymentAddress) Используется для предотвращения ошибочных регистраций чеков на ККТ зарегистрированных с другим адресом места расчёта (сравнивается со значением в ФН). Максимальная длина строки – 256 символов Parameters: Name Type Description paymentAddress Адрес места расчетов. To Do: попросить реализовать в апи Returns: Type KkmCheck setEmail(email) Если чек выдается электронно, то в запросе обязательно должно быть заполнено одно из полей: email или phone. Максимальная длина строки – 64 символа. Parameters: Name Type Description email string Электронная почта покупателя Returns: Type KkmCheck setPhone(phone) Если чек выдается электронно, то в запросе обязательно должно быть заполнено одно из полей: email или phone. Максимальная длина строки – 64 символа. Parameters: Name Type Description phone string Телефон покупателя. Передается без префикса «+7». Returns: Type KkmCheck setSno(sno) Система налогообложения. где sno 0 | «osn» – общая СН; 1 | «usn_income» – упрощенная СН(доходы); 2 | «usn_income_outcome» – упрощенная СН (доходы минус расходы); 3 | «envd» – единый налог на вмененный доход; 4 | «esn» – единый сельскохозяйственный налог; 5 | «patent» – патентная СН. Parameters: Name Type Description sno number | string Система налогообложения (см. KkmCommandCheck#TaxVariant) Returns: Type KkmCheck Example check.setSno(0);// check.setSno('osn') setTaxVariant() Синоним к setSno See: KkmCheck#setSno setKpp(Kpp) КПП организации, нужно только для ЕГАИС Parameters: Name Type Description Kpp string Returns: Type KkmCheck setTotal(amount) Сумма продажи Данный метод для явного указания общей суммы товаров в чеке перед вызовом фискализации методами fiscalCash или fiscalCard также сумма накапливается при добавлении строк методом r(). Если оплата наличными, то полученные от покупателя деньги - в чеке будет строка сдача. Parameters: Name Type Description amount number При оплате наличными не менее стоимости товаров See: KkmCheck#getTotal Returns: Type KkmCheck getTotal() Стоимость товаров в чеке, добавленных через метод r() или указанная явно See: KkmCheck#setTotal Returns: Type number setPayments(cash [, less1] [, less2] [, less3]) Как будет оплачен . Позволяет оперировать до 3х видов настроенных у кассы безналичных расчетов. см методы фискализации и альтернативное указание суммы Parameters: Name Type Argument Default Description cash number Наличными less1 number &lt;optional&gt; 0 Безналичный тип 1 (по умаолчанию карта) less2 number &lt;optional&gt; 0 Безналичный тип 2 less3 number &lt;optional&gt; 0 Безналичный тип 3 See: описание методов оплаты в API KkmCheck#fiscal KkmCheck#fiscalCash KkmCheck#fiscalCard KkmCheck#setTotal addCheckProps(print, printInHeader, teg, value) Добаляет данные по тегам 1005 Адрес оператора по переводу денежных средств (Строка 100) 1016 ИНН оператора по переводу денежных средств (Строка 12) 1026 Наименование оператора по переводу денежных средств (Строка 64) 1044 Операция банковского агента (Строка 24) 1045 Операция банковского субагента (Строка 24) 1073 Телефон банковского агента (Строка 19) 1074 Телефон платежного агента (Строка 19) 1075 Телефона оператора по переводу денежных средств (Строка 19) 1082 Телефон банковского субагента (Строка 19) 1083 Телефон платежного субагента (Строка 19) 1119 Телефон оператора по приему платежей (Строка 19) 1117 адрес электронной почты отправителя чека Parameters: Name Type Description print boolean печатать printInHeader boolean печатать в шапке teg number номер тега value string значение тега Returns: Type KkmCheckProperty addAdditionalProps(print, printInHeader, name, value) Дополнительные свойства чека Parameters: Name Type Description print boolean печатать printInHeader boolean печатать в шапке name string наименование value string значение тега Returns: Type KkmAdditionalCheckProperty setIdCommand(idCommand) Уникальный идентификатор команды Parameters: Name Type Description idCommand string Returns: Type KkmCheck setIsFiscalCheck(isFiscal) Это фискальный или не фискальный чек Parameters: Name Type Description isFiscal boolean Returns: Type KkmCheck setNotPrint(notPrint) Не печатать чек на бумагу Parameters: Name Type Description notPrint boolean Returns: Type KkmCheck setTimeout(timeout) Время (сек) ожидания выполнения команды. Parameters: Name Type Description timeout number Returns: Type KkmCheck setKktNumber(kktNumber) Заводской номер ККМ для поиска. Если &quot;&quot; то ККМ ищется только по NumDevice Parameters: Name Type Description kktNumber string Returns: Type KkmCheck setNumberCopies(numberCopies) Количество копий документа Parameters: Name Type Description numberCopies number Returns: Type KkmCheck addRegisterString(name, quantity, price, amount, tax [, department] [, ean13]) Фискальная строка чека Parameters: Name Type Argument Description name string Название товара quantity number Количество price number цена amount number сумма tax number Налогообложение department number &lt;optional&gt; отдел магазина ean13 string &lt;optional&gt; штрих код Returns: Type Object r(name, quantity, price, amount, tax [, department] [, ean13]) Шоркат к addRegisterString. Поддерживает цепочку вызовов. Parameters: Name Type Argument Description name string quantity number price number amount number tax number department number &lt;optional&gt; ean13 string &lt;optional&gt; See: addRegisterString Returns: Type KkmCheck addTextString(Text [, Font] [, Intensity]) Добавляем текстовую строку - При вставке в текст в середину строки символов &quot;&quot; Левая часть строки будет выравнена по левому краю, правая по правому, где 10 - это на сколько меньше станет строка ККТ &gt; - При вставке в текст в середину строки символов &quot;&gt;&quot; Левая часть строки будет выравнена по правому краю, правая по правому, где 10 - отступ от правого края &gt;#10# Parameters: Name Type Argument Description Text string текст для вывода с управляющими кодами Font number &lt;optional&gt; Шрифт 1-4 , 0 - по настройкам ККМ Intensity number &lt;optional&gt; Интесивность 1-15 , 0 - по настройкам ККМ Returns: Type Object Example var string4edit = check.addTextString('ЗАГОЛОВОК'); string4edit.Text = '&gt;#0#&lt;' + string4edit.Text; // Добавляем центрирование string4edit.Font=1; // Самый крупный шрифт string4edit.Intensity = 15; t(Text, Font, Intensity) Шорткат к addTextString. Поддерживает цепочку вызовов. Parameters: Name Type Description Text string Font number Intensity number See: addTextString Returns: Type KkmCheck addBarcodeString(BarcodeType, Barcode) Добавление печати штрихкода. Parameters: Name Type Description BarcodeType string &quot;EAN13&quot;, &quot;CODE39&quot;, &quot;CODE128&quot;, &quot;QR&quot;, &quot;PDF417&quot; Barcode string Значение See: шорткат b() Returns: Type Object Example var barString = check.addBarcodeString(&quot;EAN13&quot;, &quot;1254789547853&quot;); // можно модифицировать сформированную строку barString.BarcodeType = ''; barString.Barcode = ''; b(BarcodeType, Barcode) Шорткат к addBarcodeString. Поддерживает цепочку вызовов. Parameters: Name Type Description BarcodeType string Barcode string See: addBarcodeString Returns: Type KkmCheck addImageString(Image) Строка с печатью картинки Parameters: Name Type Description Image string Картинка в Base64. Картинка будет преобразована в 2-х цветное изображение - поэтому лучше посылать 2-х цветный bmp See: шорткат i() Returns: Type Object Example check.addImageString('').Image = demoImage; // можно модифицировать i(Image) Шорткат к addImageString . Поддерживает цепочку вызовов. Parameters: Name Type Description Image string See: addImageString Returns: Type KkmCheck print() Печать слип-чека (произвольного документа) Returns: Type KkmCommandCheck fiscal() Фискализация чека Returns: Type KkmCommandCheck fiscalCash() Фискализация наличкой Returns: Type KkmCommandCheck Example // это удобнее, так как можно заготовить чек и просто повесить на две кнопки выбор способа оплаты check.r(...).r(...).r(...).setTotal(100); // заранее check.fiscalCash(); // на клик // чем еще разбираться с параметрами setPayments check.setPayments(100,0).fiscal(); // эквивалент fiscalCard() Фискализация оплаты картой Returns: Type KkmCommandCheck Example check.setTotal(100).fiscalCard(); // эквиваленто check.setPayments(0,100).fiscal(); fiscalOnly() Фискализация чека без печати бумажного требует явного указания типа безналичной оплаты через .setPayments Returns: Type KkmCommandCheck × Search results Close "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
