<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"global.html":{"id":"global.html","title":"Global","body":" KkmServer API Classes KkmCheckKkmCommandKkmCommandListKkmCommandWithAmountKkmCommandWithCashierKkmResponseKkmServer Global Global Global Type Definitions callbackKkmApi() Parameters: Type Description KkmResponse KkmEGAIS Данные для ЕГАИС системы Type: object Properties: Name Type Description Barcode string Ean string Volume number × Search results Close "},"classes.list.html":{"id":"classes.list.html","title":"Classes","body":" KkmServer API Classes KkmCheckKkmCommandKkmCommandListKkmCommandWithAmountKkmCommandWithCashierKkmResponseKkmServer Global Global Classes Classes KkmCheck KkmCommand KkmCommandList KkmCommandWithAmount KkmCommandWithCashier KkmResponse KkmServer Класс для взаимодействия с API × Search results Close "},"index.html":{"id":"index.html","title":"Index","body":" KkmServer API Classes KkmCheckKkmCommandKkmCommandListKkmCommandWithAmountKkmCommandWithCashierKkmResponseKkmServer Global Global KkmServer.jsJs-библиотека для взаимодействия со специальным сервером, посредствомAjax запросов. Дополнительные библиотеки не требуются. KkmServer Программа предназначена для печати и регистрации фискальных/не фискальных чеков на Контрольно-кассовой технике оборудованной фискальным накопителем (далее ККТ). Программа является маленьким HTTP web-сервером и имеет встроенные драйвера ККТ (кроме драйверов Usb-Com). Позволяет печатать/регистрировать чеки с мобильных устройств / планшетов или с настольного ПК из 1с одновременно. Позволяет печатать/регистрировать чеки на KKM подключенных к другим ПК. Есть возможность печати этикеток с штрих-кодами на принтерах этикеток. Так-же возможно использовать ККТ в качестве принтера этикеток. Технология использования - HTTP(Ajax/REST) запрос, данные передаются через JSON; Страница программы Пример использованияПодключаем библиотеку &lt;script src=&quot;./src/kkmserver.js&quot;&gt;&lt;/script&gt;После этого взаимодействие с кассой идет через объект KkmServer. Описываем CallBack/** * Функция вызываемая после обработки команды - обработка возвращаемых данных * @param {{Status,Error,URL,Command,IdCommand,NumDevice}} Rezult - ответ ККM */ function ExecuteSuccess(Rezult) { var Responce = &quot;&quot;; if (Rezult.Status === 0) { Responce = Responce + &quot;Статус: &quot; + &quot;Ok&quot; + &quot;\\r\\n&quot;; } else if (Rezult.Status === 1) { Responce = Responce + &quot;Статус: &quot; + &quot;Выполняется&quot; + &quot;\\r\\n&quot;; } else if (Rezult.Status === 2) { Responce = Responce + &quot;Статус: &quot; + &quot;Ошибка!&quot; + &quot;\\r\\n&quot;; } else if (Rezult.Status === 3) { Responce = Responce + &quot;Статус: &quot; + &quot;Данные не найдены!&quot; + &quot;\\r\\n&quot;; } // Текст ошибки if (Rezult.Error !== undefined &amp;&amp; Rezult.Error !== &quot;&quot;) { Responce = Responce + &quot;Ошибка: &quot; + Rezult.Error + &quot;\\r\\n&quot;; } if (Rezult !== undefined) { var JSon = JSON.stringify(Rezult, null, 4); Responce = Responce + &quot;JSON ответа: \\r\\n&quot; + JSon + &quot;\\r\\n&quot;; } document.getElementById('Responce').textContent = Responce; }ИнициализацияKkmServer.connect('Admin', '').setHookAjaxSuccess(ExecuteSuccess)Выполнение команд KkmServer.depositingCash(2.05); var check = KkmServer.OpenCheck(); check.addRegisterString('Мыло',1,1,1); check.Data.Cash = 1; KkmServer.execute(check.Data);Enjoy HistoryАльфа версии 0.1.0 - Переработан полностью набор методов. Добавлена документация. 0.0.2 - Первая публичная версия Index kkmserver.js Js-библиотека для взаимодействия со специальным сервером, посредством Ajax запросов. Дополнительные библиотеки не требуются. Version: 0.1.0 Author: Oleg Muraveyko See: Source code on Github https://github.com/Muraveiko/kkmserver Server API part by Dmitriy Garbuz https://kkmserver.ru/KkmServer × Search results Close "},"KkmCheck.html":{"id":"KkmCheck.html","title":"Class: KkmCheck","body":" KkmServer API Classes KkmCheckKkmCommandKkmCommandListKkmCommandWithAmountKkmCommandWithCashierKkmResponseKkmServer Global Global Class: KkmCheck KkmCheck new KkmCheck(kkm [, typeCheck]) Конструктор Класса Чек (для работы с фискальным документом или слип-чеком) Parameters: Name Type Argument Default Description kkm KkmServer куда посылать typeCheck number &lt;optional&gt; 0 Тип чека 0 – продажа; 10 – покупка; 1 – возврат продажи; 11 - возврат покупки; 8 - продажа только по ЕГАИС (обычный чек ККМ не печатается) 9 - возврат продажи только по ЕГАИС (обычный чек ККМ не печатается) Members kkm :KkmServer Внедрение зависимости Type: KkmServer Methods addBarcodeString(BarcodeType, Barcode) Добавление печати штрихкода Parameters: Name Type Description BarcodeType string &quot;EAN13&quot;, &quot;CODE39&quot;, &quot;CODE128&quot;, &quot;QR&quot;, &quot;PDF417&quot; Barcode string Returns: Type Object Example check.addBarcodeString(&quot;EAN13&quot;, &quot;1254789547853&quot;); addImageString(Image) Parameters: Name Type Description Image Returns: Type Object addRegisterString(name, quantity, price, amount [, tax] [, department] [, ean13] [, egais]) Фискальная строка чека Parameters: Name Type Argument Description name string Название товара quantity number Количество price number цена amount number сумма tax &lt;optional&gt; Налогообложение department &lt;optional&gt; отдел магазина ean13 string &lt;optional&gt; штрих код egais KkmServer.EGAIS &lt;optional&gt; addTextString(Text, Font, Intensity) Parameters: Name Type Description Text Font Intensity Returns: Type Object b(BarcodeType, Barcode) Parameters: Name Type Description BarcodeType Barcode Returns: Type Object fiscal() Returns: self i(Image) Parameters: Name Type Description Image Returns: Type Object print() Returns: self r(Name, Quantity, Price, Amount, Tax, Department, EAN13, EGAIS) Parameters: Name Type Description Name Quantity Price Amount Tax Department EAN13 EGAIS setEmail(email) Если чек выдается электронно, то в запросе обязательно должно быть заполнено одно из полей: email или phone. Максимальная длина строки – 64 символа. Parameters: Name Type Description email string Электронная почта покупателя Returns: self setInn(innKkm) Используется для предотвращения ошибочных регистраций чеков на ККТ зарегистрированных с другим ИНН (сравнивается со значением в ФН). Допустимое количество символов 10 или 12. Parameters: Name Type Description innKkm string ИНН организации Returns: self setPaymentAddress(paymentAddress) Используется для предотвращения ошибочных регистраций чеков на ККТ зарегистрированных с другим адресом места расчёта (сравнивается со значением в ФН). Максимальная длина строки – 256 символов Parameters: Name Type Description paymentAddress Адрес места расчетов. Returns: self setPhone(phone) Если чек выдается электронно, то в запросе обязательно должно быть заполнено одно из полей: email или phone. Максимальная длина строки – 64 символа. Parameters: Name Type Description phone string Телефон покупателя. Передается без префикса «+7». Returns: self setSno(sno) Система налогообложения. Перечисление со значениями: «osn» – общая СН; «usn_income» – упрощенная СН(доходы); «usn_income_outcome» – упрощенная СН (доходы минус расходы); «envd» – единый налог на вмененный доход; «esn» – единый сельскохозяйственный налог; «patent» – патентная СН. Parameters: Name Type Description sno string Система налогообложения (см. допустимые значения) Returns: self t(Text, Font, Intensity) Parameters: Name Type Description Text Font Intensity Returns: Type Object × Search results Close "},"KkmCommand.html":{"id":"KkmCommand.html","title":"Class: KkmCommand","body":" KkmServer API Classes KkmCheckKkmCommandKkmCommandListKkmCommandWithAmountKkmCommandWithCashierKkmResponseKkmServer Global Global Class: KkmCommand KkmCommand new KkmCommand(command [, numDevice]) Базовая структура запроса к серверу Parameters: Name Type Argument Description command string Имя команды numDevice number &lt;optional&gt; устройство Members Command :string Название команды, одно из зарегистрированных слов api KkmServer.ru. необходимые реализованы как методы CommandXXX KkmServer Type: string IdCommand :string Уникальный идентификатор команды Любая строока из 40 символов По этому идентификатору можно запросить результат выполнения команды. Поле не обязательно Type: string NumDevice :number|null Номер устройства 0-9 по умолчанию 0 - первое свободное Type: number | null × Search results Close "},"KkmCommandList.html":{"id":"KkmCommandList.html","title":"Class: KkmCommandList","body":" KkmServer API Classes KkmCheckKkmCommandKkmCommandListKkmCommandWithAmountKkmCommandWithCashierKkmResponseKkmServer Global Global Class: KkmCommandList KkmCommandList new KkmCommandList() Команда Список ККТ подключенных к серверу Extends KkmCommand Members Active :boolean|null Отбор активных. Булево. Если null или не указано то активные и не активные Type: boolean | null Example command = new KkmCommandList(); command.InnKkm = '1234567890'; Command :string Название команды, одно из зарегистрированных слов api KkmServer.ru. необходимые реализованы как методы CommandXXX KkmServer Type: string Inherited From: KkmCommand#Command FN_DateEnd :string Все у которых дата окончания работы ФН меньше указанной. Дата-время. Type: string FN_IsFiscal :boolean|null Фискализированные или нет ФН; Булево. Если null или не указано то все Type: boolean | null FN_MemOverflowl :boolean|null Все у которых заканчивается память ФН; Булево. Если null или не указано то все Type: boolean | null IdCommand :string Уникальный идентификатор команды Любая строока из 40 символов По этому идентификатору можно запросить результат выполнения команды. Поле не обязательно Type: string Inherited From: KkmCommand#IdCommand InnKkm :string Отбор по ИНН. Строка. Если &quot;&quot; или не указано то первое не блокированное на сервере Type: string NumDevice :number|null Номер устройства 0-9 по умолчанию 0 - первое свободное Type: number | null Inherited From: KkmCommand#NumDevice OFD_DateErrorDoc :string Все у которых дата не переданного док. в ОФД меньше указанной. Дата-время. Type: string Example command = new KkmCommandList(); command.OFD_DateErrorDoc = '2100-01-01T00:00:00'; OFD_Error :boolean|null Отбор наличию ошибок ОФВ. Булево. Если null или не указано то с ошибками и без Type: boolean | null OnOff :boolean|null Отбор выключенны-включенных Type: boolean | null Example command = new KkmCommandList(); command.Active = true; × Search results Close "},"KkmCommandWithAmount.html":{"id":"KkmCommandWithAmount.html","title":"Class: KkmCommandWithAmount","body":" KkmServer API Classes KkmCheckKkmCommandKkmCommandListKkmCommandWithAmountKkmCommandWithCashierKkmResponseKkmServer Global Global Class: KkmCommandWithAmount KkmCommandWithAmount new KkmCommandWithAmount(command, amount, cashierName, numDevice) Структура запроса к серверу c суммой операции Parameters: Name Type Description command string Имя команды amount number Сумма cashierName string ФИО Кассира numDevice number устройство Extends KkmCommandWithCashier Members Amount :number Сумма операции Type: number CashierName :string|null ФИО Кассира Type: string | null Inherited From: KkmCommandWithCashier#CashierName Command :string Название команды, одно из зарегистрированных слов api KkmServer.ru. необходимые реализованы как методы CommandXXX KkmServer Type: string Inherited From: KkmCommand#Command IdCommand :string Уникальный идентификатор команды Любая строока из 40 символов По этому идентификатору можно запросить результат выполнения команды. Поле не обязательно Type: string Inherited From: KkmCommand#IdCommand NumDevice :number|null Номер устройства 0-9 по умолчанию 0 - первое свободное Type: number | null Inherited From: KkmCommand#NumDevice × Search results Close "},"KkmCommandWithCashier.html":{"id":"KkmCommandWithCashier.html","title":"Class: KkmCommandWithCashier","body":" KkmServer API Classes KkmCheckKkmCommandKkmCommandListKkmCommandWithAmountKkmCommandWithCashierKkmResponseKkmServer Global Global Class: KkmCommandWithCashier KkmCommandWithCashier new KkmCommandWithCashier(command [, cashierName] [, numDevice]) Структура запроса к серверу c ФИО кассира Parameters: Name Type Argument Description command string Имя команды cashierName string &lt;optional&gt; ФИО Кассира numDevice number &lt;optional&gt; устройство Extends KkmCommand Members CashierName :string|null ФИО Кассира Type: string | null Command :string Название команды, одно из зарегистрированных слов api KkmServer.ru. необходимые реализованы как методы CommandXXX KkmServer Type: string Inherited From: KkmCommand#Command IdCommand :string Уникальный идентификатор команды Любая строока из 40 символов По этому идентификатору можно запросить результат выполнения команды. Поле не обязательно Type: string Inherited From: KkmCommand#IdCommand NumDevice :number|null Номер устройства 0-9 по умолчанию 0 - первое свободное Type: number | null Inherited From: KkmCommand#NumDevice × Search results Close "},"KkmResponse.html":{"id":"KkmResponse.html","title":"Class: KkmResponse","body":" KkmServer API Classes KkmCheckKkmCommandKkmCommandListKkmCommandWithAmountKkmCommandWithCashierKkmResponseKkmServer Global Global Class: KkmResponse KkmResponse new KkmResponse() Ответ API Properties: Name Type Argument Description Command string Команда апи Status number Статус исполнения Ok = 0,Run(Запущено на выполнение) = 1,Error = 2,NotFound(устройство не найдено) = 3,NotRun = 4 Error string Пустая строка или текст ошибки URL string &lt;optional&gt; IdCommand string Уникальный идентификатор комманды, назначенный вами или присвоенный сервером. NumDevice number &lt;optional&gt; × Search results Close "},"KkmServer.html":{"id":"KkmServer.html","title":"Class: KkmServer","body":" KkmServer API Classes KkmCheckKkmCommandKkmCommandListKkmCommandWithAmountKkmCommandWithCashierKkmResponseKkmServer Global Global Class: KkmServer KkmServer new KkmServer(user, password [, urlServer]) Класс для взаимодействия с API Методы класса можно разделить на группы CommandXxx - возвращают структуру данных для передачи серверу, которую можно модифицировать doXxx - выполняют сразу нужную операцию funXxx - встроенные обработчики AJAX hookXxx - установить свои обработчики для AJAX setXxx - устанавливают параметры по умолчанию для команд execute - посылает ajax запрос серверу с тонкой настройкой чеки - отдельный класс KkmCheck Конструктор принимает параметры подключения к серверу : Parameters: Name Type Argument Description user string Имя пользователя password string Пароль urlServer string &lt;optional&gt; Адрес сервера Example var kkm = new KkmServer('Admin', '').hookAjaxSuccess(ExecuteSuccess); kkm.doOpenShift(); Methods CommandDepositingCash(amount [, cashierName] [, numDevice]) Команда Внесение денег в кассу Parameters: Name Type Argument Description amount number Сумма cashierName string &lt;optional&gt; имя кассира numDevice number &lt;optional&gt; устройство See: CommandPaymentCash Returns: Type KkmCommandWithAmount CommandGetDataKKT( [numDevice]) Команда Получение данных KKT Parameters: Name Type Argument Description numDevice number &lt;optional&gt; устройство Returns: Type KkmCommand CommandGetRezult( [idCommand] [, numDevice]) Команда Запрос результата выполнения команды Parameters: Name Type Argument Description idCommand string &lt;optional&gt; numDevice number &lt;optional&gt; устройство Returns: Type KkmCommand CommandList() Команда Список подключенных устройств Returns: Type KkmCommandList CommandOfdReport( [numDevice]) Команда Печать состояния обмена с ОФД Parameters: Name Type Argument Description numDevice number &lt;optional&gt; устройство Returns: Type KkmCommand CommandOpenCashDrawer( [numDevice]) Команда Открыть денежный ящик Parameters: Name Type Argument Description numDevice number &lt;optional&gt; устройство Returns: Type KkmCommand CommandOpenShift( [CashierName] [, numDevice]) Команда Окрыть смену Parameters: Name Type Argument Description CashierName string &lt;optional&gt; имя кассира numDevice number &lt;optional&gt; устройство Returns: Type KkmCommandWithCashier CommandPaymentCash(Amount [, CashierName] [, numDevice]) Команда Выемка наличных Parameters: Name Type Argument Description Amount number Сумма CashierName string &lt;optional&gt; имя кассира numDevice number &lt;optional&gt; устройство Returns: Type KkmCommandWithAmount CommandXReport( [CashierName] [, numDevice]) Команда Печать Х-отчета Parameters: Name Type Argument Description CashierName string &lt;optional&gt; имя кассира numDevice number &lt;optional&gt; устройство Returns: Type KkmCommandWithCashier CommandZReport( [CashierName] [, numDevice]) Команда Закрытие смены Parameters: Name Type Argument Description CashierName string &lt;optional&gt; имя кассира numDevice number &lt;optional&gt; устройство Returns: Type KkmCommandWithCashier doDepositingCash(Amount [, CashierName] [, numDevice]) Внесение денег в кассу Parameters: Name Type Argument Description Amount number Сумма CashierName string &lt;optional&gt; имя кассира numDevice number &lt;optional&gt; устройство Returns: Type KkmCommandWithAmount doGetDataKKT( [numDevice]) Получение данных KKT Parameters: Name Type Argument Description numDevice number &lt;optional&gt; устройство Returns: Type KkmCommand doGetList() Список ККТ подключенных к серверу Returns: Type KkmCommand doGetRezult( [IdCommand] [, numDevice]) Запрос результата выполнения команды Parameters: Name Type Argument Description IdCommand string &lt;optional&gt; numDevice number &lt;optional&gt; устройство Returns: Type KkmCommand doOfdReport( [numDevice]) Печать состояния обмена с ОФД Parameters: Name Type Argument Description numDevice number &lt;optional&gt; устройство Returns: Type KkmCommand doOpenCashDrawer( [numDevice]) Открыть денежный ящик Parameters: Name Type Argument Description numDevice number &lt;optional&gt; устройство Returns: Type KkmCommand doOpenShift( [cashierName] [, numDevice]) Окрыть смену Parameters: Name Type Argument Description cashierName string &lt;optional&gt; имя кассира numDevice number &lt;optional&gt; устройство Returns: Type KkmCommandWithCashier doPaymentCash(Amount [, CashierName] [, numDevice]) Выемка наличных Parameters: Name Type Argument Description Amount number Сумма CashierName string &lt;optional&gt; имя кассира numDevice number &lt;optional&gt; устройство Returns: Type KkmCommandWithAmount doXReport( [CashierName] [, numDevice]) Печать Х-отчета Parameters: Name Type Argument Description CashierName string &lt;optional&gt; имя кассира numDevice number &lt;optional&gt; устройство Returns: Type KkmCommand doZReport( [CashierName] [, numDevice]) Закрытие смены Parameters: Name Type Argument Description CashierName string &lt;optional&gt; имя кассира numDevice number &lt;optional&gt; устройство Returns: Type KkmCommand execute(command) Передача команды серверу . Parameters: Name Type Description command KkmCommand | KkmCommandWithCashier | KkmCommandWithAmount | KkmCommandList Структура для передачи серверу Returns: Type KkmCommand | KkmCommandWithCashier | KkmCommandWithAmount | KkmCommandList hookAjaxFail(errorHook) Обработчик ошибки запроса Parameters: Name Type Description errorHook funError callback Returns: Type KkmServer hookAjaxSuccess(successHook) Обработчик успешного запроса к серверу Parameters: Name Type Description successHook callbackKkmApi Returns: Type KkmServer setCashierName(cashierName) Кассир по умолчанию Parameters: Name Type Description cashierName string ФИО Returns: Type KkmServer setInnKkm(innKkm) Инн кассы чтобы чек не ушел неправильно Parameters: Name Type Description innKkm string Returns: Type KkmServer setNumDevice(numDevice) Номер Устройства по умолчанию Parameters: Name Type Description numDevice number целое 0-9 Returns: Type KkmServer &lt;inner&gt; funError(xhr, status) Встроенный обработчик ошибки сети при запросе к серверу Parameters: Name Type Description xhr status See: назначить свой KkmServer#hookAjaxFail &lt;inner&gt; funSuccess(result) Встроенный обработчик успешного запроса к серверу Parameters: Name Type Description result KkmResponse | object See: назначить свой KkmServer#hookAjaxSuccess × Search results Close "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
